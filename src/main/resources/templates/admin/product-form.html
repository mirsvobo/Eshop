<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/admin-layout}">
<head>
  <title th:text="${product.id == null} ? 'Přidat nový produkt' : 'Upravit produkt'"></title>
  <style>
    /* Styl pro vizuální odlišení neaktivní sekce konfigurátoru */
    #configuratorSettings.config-disabled {
      opacity: 0.7;
      pointer-events: none; /* Volitelně zablokovat interakci */
      background-color: #f8f9fa; /* Lehce našedlé pozadí */
    }
    .image-preview {
      position: relative; display: inline-block; margin: 5px; vertical-align: top;
    }
    .image-preview img {
      max-width: 100px; max-height: 100px; display: block; border: 1px solid #ddd;
    }
    .delete-image-btn { /* Upraveno pro formulářové tlačítko */
      /* Není potřeba absolutní pozice, bude vedle */
    }
    /* Styling pro invalid-feedback, aby byl vidět */
    .invalid-feedback.d-block { display: block !important; }
    .alert-sm { padding: 0.5rem 1rem; font-size: 0.875rem; } /* Menší alerty pro obrázky */
  </style>
</head>
<body>
<div layout:fragment="content">
  <h1 th:text="${product.id == null} ? 'Přidat nový produkt' : 'Upravit produkt'"></h1>

  <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
  <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
  <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div> <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div> <form th:action="${product.id == null} ? @{/admin/products} : @{/admin/products/{id}(id=${product.id})}"
                                                                                                                                                                                                                         th:object="${product}" method="post" enctype="multipart/form-data" id="productForm">

  <input type="hidden" name="_method" th:if="${product.id != null}" value="POST"/>


  <div th:if="${#fields.hasErrors('*')}" class="alert alert-danger" role="alert">
    Prosím opravte následující chyby:
    <ul>
      <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
      <li th:each="err : ${#fields.globalErrors()}" th:text="${err}"></li>
    </ul>
  </div>

  <input type="hidden" th:field="*{id}" />
  <input type="hidden" th:field="*{version}" />

  <div class="mb-3">
    <label for="name" class="form-label">Název produktu:</label>
    <input type="text" class="form-control" id="name" th:field="*{name}" required>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
  </div>

  <div class="mb-3">
    <label for="shortDescription" class="form-label">Krátký popis (max 500 znaků):</label>
    <textarea class="form-control" id="shortDescription" th:field="*{shortDescription}" rows="3" maxlength="500"></textarea>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('shortDescription')}" th:errors="*{shortDescription}"></div>
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">Hlavní Popis:</label>
    <textarea class="form-control" id="description" th:field="*{description}" rows="5"></textarea>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <label for="basePriceCZK" class="form-label">Základní cena CZK (bez DPH):</label>
      <input type="number" step="0.01" class="form-control" id="basePriceCZK" th:field="*{basePriceCZK}" required>
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('basePriceCZK')}" th:errors="*{basePriceCZK}"></div>
    </div>
    <div class="col-md-6">
      <label for="basePriceEUR" class="form-label">Základní cena EUR (bez DPH):</label>
      <input type="number" step="0.01" class="form-control" id="basePriceEUR" th:field="*{basePriceEUR}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('basePriceEUR')}" th:errors="*{basePriceEUR}"></div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <label for="model" class="form-label">Model:</label>
      <input type="text" class="form-control" id="model" th:field="*{model}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('model')}" th:errors="*{model}"></div>
    </div>
    <div class="col-md-6">
      <label for="material" class="form-label">Materiál:</label>
      <input type="text" class="form-control" id="material" th:field="*{material}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('material')}" th:errors="*{material}"></div>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-md-3">
      <label for="length" class="form-label">Standardní Délka (cm):</label>
      <input type="number" step="0.01" class="form-control" id="length" th:field="*{length}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('length')}" th:errors="*{length}"></div>
    </div>
    <div class="col-md-3">
      <label for="width" class="form-label">Standardní Šířka/Hloubka (cm):</label>
      <input type="number" step="0.01" class="form-control" id="width" th:field="*{width}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('width')}" th:errors="*{width}"></div>
    </div>
    <div class="col-md-3">
      <label for="height" class="form-label">Standardní Výška (cm):</label>
      <input type="number" step="0.01" class="form-control" id="height" th:field="*{height}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('height')}" th:errors="*{height}"></div>
    </div>
    <div class="col-md-3">
      <label for="roofOverstep" class="form-label">Přesah střechy:</label>
      <input type="text" class="form-control" id="roofOverstep" th:field="*{roofOverstep}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('roofOverstep')}" th:errors="*{roofOverstep}"></div>
    </div>
  </div>
  <div class="mb-3">
    <label for="slug" class="form-label">URL Slug (nepovinné, vygeneruje se z názvu):</label>
    <input type="text" class="form-control" id="slug" th:field="*{slug}">
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('slug')}" th:errors="*{slug}"></div>
  </div>

  <div class="form-check mb-3">
    <input type="checkbox" class="form-check-input" id="active" th:field="*{active}">
    <label class="form-check-label" for="active">Aktivní (viditelný v e-shopu)</label>
  </div>

  <hr>
  <h4>Daňové sazby</h4>
  <div class="mb-3">
    <label class="form-label">Přiřazené daňové sazby (alespoň jedna):</label>
    <div th:each="rate : ${allTaxRates}" class="form-check">
      <input class="form-check-input" type="checkbox" th:value="${rate.id}" th:id="'taxRate_' + ${rate.id}" th:field="*{availableTaxRates}">
      <label class="form-check-label" th:for="'taxRate_' + ${rate.id}" th:text="${rate.name + ' (' + rate.rate + '%)'}"></label>
    </div>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('availableTaxRates')}" th:errors="*{availableTaxRates}"></div>
    <div class="text-danger small mt-1" th:if="${#fields.hasGlobalErrors()}" th:each="err : ${#fields.globalErrors()}" th:text="${err}"></div>
  </div>

  <hr>
  <h4>Standardní konfigurace (pro ne-custom produkty)</h4>
  <div class="mb-3">
    <label class="form-label">Dostupné lazury:</label>
    <div th:each="glaze : ${allGlazes}" class="form-check">
      <input class="form-check-input" type="checkbox" th:value="${glaze.id}" th:id="'glaze_' + ${glaze.id}" th:field="*{availableGlazes}">
      <label class="form-check-label" th:for="'glaze_' + ${glaze.id}" th:text="${glaze.name}"></label>
    </div>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('availableGlazes')}" th:errors="*{availableGlazes}"></div>
  </div>
  <div class="mb-3">
    <label class="form-label">Dostupné designy:</label>
    <div th:each="design : ${allDesigns}" class="form-check">
      <input class="form-check-input" type="checkbox" th:value="${design.id}" th:id="'design_' + ${design.id}" th:field="*{availableDesigns}">
      <label class="form-check-label" th:for="'design_' + ${design.id}" th:text="${design.name}"></label>
    </div>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('availableDesigns')}" th:errors="*{availableDesigns}"></div>
  </div>
  <div class="mb-3">
    <label class="form-label">Dostupné barvy střechy:</label>
    <div th:each="roofColor : ${allRoofColors}" class="form-check">
      <input class="form-check-input" type="checkbox" th:value="${roofColor.id}" th:id="'roofColor_' + ${roofColor.id}" th:field="*{availableRoofColors}">
      <label class="form-check-label" th:for="'roofColor_' + ${roofColor.id}" th:text="${roofColor.name}"></label>
    </div>
    <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('availableRoofColors')}" th:errors="*{availableRoofColors}"></div>
  </div>

  <hr>
  <h4>Konfigurátor produktu na míru</h4>
  <div class="form-check mb-3">
    <input type="checkbox" class="form-check-input" id="customisable" th:field="*{customisable}">
    <label class="form-check-label" for="customisable">Povolit konfiguraci na míru pro tento produkt</label>
  </div>

  <div id="configuratorSettings" th:classappend="*{!customisable} ? 'config-disabled' : ''">
    <h5>Rozměry (v cm) - zadejte rozmezí nebo pevné hodnoty</h5>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.minLength" class="form-label">Min. Délka:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.minLength" th:field="*{configurator.minLength}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.minLength')}" th:errors="*{configurator.minLength}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.maxLength" class="form-label">Max. Délka:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.maxLength" th:field="*{configurator.maxLength}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.maxLength')}" th:errors="*{configurator.maxLength}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.defaultLength" class="form-label">Výchozí Délka:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.defaultLength" th:field="*{configurator.defaultLength}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.defaultLength')}" th:errors="*{configurator.defaultLength}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.stepLength" class="form-label">Krok Délky:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.stepLength" th:field="*{configurator.stepLength}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.stepLength')}" th:errors="*{configurator.stepLength}"></div>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.minWidth" class="form-label">Min. Šířka/Hloubka:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.minWidth" th:field="*{configurator.minWidth}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.minWidth')}" th:errors="*{configurator.minWidth}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.maxWidth" class="form-label">Max. Šířka/Hloubka:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.maxWidth" th:field="*{configurator.maxWidth}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.maxWidth')}" th:errors="*{configurator.maxWidth}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.defaultWidth" class="form-label">Výchozí Šířka/Hloubka:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.defaultWidth" th:field="*{configurator.defaultWidth}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.defaultWidth')}" th:errors="*{configurator.defaultWidth}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.stepWidth" class="form-label">Krok Šířky/Hloubky:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.stepWidth" th:field="*{configurator.stepWidth}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.stepWidth')}" th:errors="*{configurator.stepWidth}"></div>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.minHeight" class="form-label">Min. výška:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.minHeight" th:field="*{configurator.minHeight}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.minHeight')}" th:errors="*{configurator.minHeight}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.maxHeight" class="form-label">Max. výška:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.maxHeight" th:field="*{configurator.maxHeight}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.maxHeight')}" th:errors="*{configurator.maxHeight}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.defaultHeight" class="form-label">Výchozí výška:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.defaultHeight" th:field="*{configurator.defaultHeight}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.defaultHeight')}" th:errors="*{configurator.defaultHeight}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.stepHeight" class="form-label">Krok výšky:</label>
        <input type="number" step="0.01" class="form-control" id="configurator.stepHeight" th:field="*{configurator.stepHeight}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.stepHeight')}" th:errors="*{configurator.stepHeight}"></div>
      </div>
    </div>
    <p class="form-text text-muted">
      Pokud chcete pevný rozměr, zadejte stejnou hodnotu do Min i Max pole. Výchozí hodnota a krok musí respektovat limity.
    </p>

    <h5>Ceny konfigurátoru (bez DPH)</h5>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.pricePerCmLengthCZK" class="form-label">Cena/cm délky (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.pricePerCmLengthCZK" th:field="*{configurator.pricePerCmLengthCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.pricePerCmLengthCZK')}" th:errors="*{configurator.pricePerCmLengthCZK}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.pricePerCmWidthCZK" class="form-label">Cena/cm Šířky/Hloubky (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.pricePerCmWidthCZK" th:field="*{configurator.pricePerCmWidthCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.pricePerCmWidthCZK')}" th:errors="*{configurator.pricePerCmWidthCZK}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.pricePerCmHeightCZK" class="form-label">Cena/cm výšky (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.pricePerCmHeightCZK" th:field="*{configurator.pricePerCmHeightCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.pricePerCmHeightCZK')}" th:errors="*{configurator.pricePerCmHeightCZK}"></div>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.pricePerCmLengthEUR" class="form-label">Cena/cm délky (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.pricePerCmLengthEUR" th:field="*{configurator.pricePerCmLengthEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.pricePerCmLengthEUR')}" th:errors="*{configurator.pricePerCmLengthEUR}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.pricePerCmWidthEUR" class="form-label">Cena/cm Šířky/Hloubky (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.pricePerCmWidthEUR" th:field="*{configurator.pricePerCmWidthEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.pricePerCmWidthEUR')}" th:errors="*{configurator.pricePerCmWidthEUR}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.pricePerCmHeightEUR" class="form-label">Cena/cm výšky (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.pricePerCmHeightEUR" th:field="*{configurator.pricePerCmHeightEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.pricePerCmHeightEUR')}" th:errors="*{configurator.pricePerCmHeightEUR}"></div>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.designPriceCZK" class="form-label">Příplatek Design (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.designPriceCZK" th:field="*{configurator.designPriceCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.designPriceCZK')}" th:errors="*{configurator.designPriceCZK}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.dividerPricePerCmDepthCZK" class="form-label">Příplatek Příčka/cm hloubky (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.dividerPricePerCmDepthCZK" th:field="*{configurator.dividerPricePerCmDepthCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.dividerPricePerCmDepthCZK')}" th:errors="*{configurator.dividerPricePerCmDepthCZK}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.gutterPriceCZK" class="form-label">Příplatek Okap (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.gutterPriceCZK" th:field="*{configurator.gutterPriceCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.gutterPriceCZK')}" th:errors="*{configurator.gutterPriceCZK}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.shedPriceCZK" class="form-label">Příplatek Bouda (CZK):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.shedPriceCZK" th:field="*{configurator.shedPriceCZK}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.shedPriceCZK')}" th:errors="*{configurator.shedPriceCZK}"></div>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="configurator.designPriceEUR" class="form-label">Příplatek Design (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.designPriceEUR" th:field="*{configurator.designPriceEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.designPriceEUR')}" th:errors="*{configurator.designPriceEUR}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.dividerPricePerCmDepthEUR" class="form-label">Příplatek Příčka/cm hloubky (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.dividerPricePerCmDepthEUR" th:field="*{configurator.dividerPricePerCmDepthEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.dividerPricePerCmDepthEUR')}" th:errors="*{configurator.dividerPricePerCmDepthEUR}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.gutterPriceEUR" class="form-label">Příplatek Okap (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.gutterPriceEUR" th:field="*{configurator.gutterPriceEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.gutterPriceEUR')}" th:errors="*{configurator.gutterPriceEUR}"></div>
      </div>
      <div class="col-md-3">
        <label for="configurator.shedPriceEUR" class="form-label">Příplatek Bouda (EUR):</label>
        <input type="number" step="0.01" class="form-control" id="configurator.shedPriceEUR" th:field="*{configurator.shedPriceEUR}">
        <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('configurator.shedPriceEUR')}" th:errors="*{configurator.shedPriceEUR}"></div>
      </div>
    </div>


    <div class="mb-3">
      <label class="form-label">Dostupné doplňky pro konfiguraci na míru:</label>
      <div th:each="addon : ${allAddons}" class="form-check">
        <input class="form-check-input" type="checkbox" th:value="${addon.id}" th:id="'addon_' + ${addon.id}" th:field="*{availableAddons}">
        <label class="form-check-label" th:for="'addon_' + ${addon.id}" th:text="${addon.name + ' (' + addon.priceCZK + ' CZK / ' + addon.priceEUR + ' EUR)'}"></label>
      </div>
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('availableAddons')}" th:errors="*{availableAddons}"></div>
    </div>
  </div> <hr>
  <h4>SEO</h4>
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="metaTitle" class="form-label">Meta Title:</label>
      <input type="text" class="form-control" id="metaTitle" th:field="*{metaTitle}">
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('metaTitle')}" th:errors="*{metaTitle}"></div>
    </div>
    <div class="col-md-6">
      <label for="metaDescription" class="form-label">Meta Description:</label>
      <textarea class="form-control" id="metaDescription" th:field="*{metaDescription}" rows="2" maxlength="1000"></textarea>
      <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('metaDescription')}" th:errors="*{metaDescription}"></div>
    </div>
  </div>

  <hr>

  <h4>Obrázky produktu</h4>
  <div class="mb-3 border p-3 rounded">
    <label class="form-label d-block">Aktuální obrázky:</label>
    <div th:if="${imageError}" class="alert alert-danger alert-sm mt-2" role="alert" th:text="${imageError}"></div>
    <div th:if="${imageSuccess}" class="alert alert-success alert-sm mt-2" role="alert" th:text="${imageSuccess}"></div>

    <form th:action="@{/admin/products/images/update-order}" method="post" id="imageOrderForm" class="mb-2">
      <input type="hidden" name="productId" th:value="*{id}" /> <div id="currentImages">
      <div th:if="${#lists.isEmpty(product.images)}" class="text-muted">Žádné obrázky nebyly nahrány.</div>
      <div th:each="image, iterStat : ${product.getImagesOrdered()}" class="image-preview d-flex align-items-center mb-2 border-bottom pb-2" th:id="'image-preview-' + ${image.id}">
        <img th:src="@{'/uploads/products/' + ${image.fileName}}" alt="Náhled obrázku" style="width: 80px; height: 80px; object-fit: cover; margin-right: 10px;">
        <div class="flex-grow-1">
          <input type="number" class="form-control form-control-sm mb-1" th:name="'displayOrder_' + ${image.id}" th:value="${image.displayOrder}" min="0" placeholder="Pořadí">
          <small th:text="${image.fileName}"></small>
        </div>
        <form th:action="@{/admin/products/images/{imageId}/delete(imageId=${image.id})}" method="post" class="ms-2">
          <button type="submit" class="btn btn-danger btn-sm delete-image-btn" title="Smazat obrázek" onclick="return confirm('Opravdu smazat tento obrázek?');">×</button>
        </form>
      </div>
    </div>
      <button type="submit" form="imageOrderForm" class="btn btn-outline-secondary btn-sm mt-2" th:if="${not #lists.isEmpty(product.images)}">Aktualizovat pořadí</button>
    </form>

    <form th:action="@{/admin/products/{productId}/images/upload(productId=${product.id})}" method="post" enctype="multipart/form-data" class="mt-3 pt-3 border-top" th:if="${product.id != null}">
      <h5>Nahrát nový obrázek</h5>
      <div class="mb-2">
        <label for="newImageFile" class="form-label">Soubor:</label>
        <input type="file" class="form-control form-control-sm" id="newImageFile" name="imageFile" required accept="image/png, image/jpeg, image/webp">
      </div>
      <div class="row g-2">
        <div class="col-md-4">
          <label for="newAltText" class="form-label">Alt text:</label>
          <input type="text" class="form-control form-control-sm" id="newAltText" name="altText">
        </div>
        <div class="col-md-4">
          <label for="newTitleText" class="form-label">Title text:</label>
          <input type="text" class="form-control form-control-sm" id="newTitleText" name="titleText">
        </div>
        <div class="col-md-4">
          <label for="newDisplayOrder" class="form-label">Pořadí:</label>
          <input type="number" class="form-control form-control-sm" id="newDisplayOrder" name="displayOrder" placeholder="Auto">
        </div>
      </div>
      <button type="submit" class="btn btn-success btn-sm mt-2">Nahrát obrázek</button>
    </form>
  </div>
  <hr>

  <button type="submit" class="btn btn-primary" th:text="${product.id == null} ? 'Vytvořit produkt' : 'Uložit změny'">Uložit</button>
  <a th:href="@{/admin/products}" class="btn btn-secondary">Zrušit</a>
</form>


</div>
</body>
</html>