document.addEventListener("DOMContentLoaded",function(){console.log("[Global JS V4] DOMContentLoaded.");const loader=document.getElementById("page-loader");if(loader){loader.classList.add("hidden");console.log("[Global JS V4] Page loader hidden immediately on DOMContentLoaded.")}else{console.warn("[Global JS V4] Page loader element '#page-loader' not found.")}});window.isTrackingServiceReady=!1;window.isConsentProcessed=!1;window.waitingTrackingActions=window.waitingTrackingActions||[];let consentProcessedListenerAttached=!1;function getGlobalDebugMode(){if(window.trackingService&&typeof window.trackingService.debugMode==='boolean'){return window.trackingService.debugMode}
    if(window.trackingServiceOptions&&typeof window.trackingServiceOptions.debugMode==='boolean'){return window.trackingServiceOptions.debugMode}
    return!1}
window.attemptToTriggerTrackingActions=function(source){const isDebug=getGlobalDebugMode();if(isDebug){console.log(`[Helper V4] attemptToTriggerTrackingActions called from: ${source}. States: TrackingReady=${window.isTrackingServiceReady}, ConsentProcessed=${window.isConsentProcessed}`)}
    triggerWaitingTrackingActions()};function triggerWaitingTrackingActions(){const isDebug=getGlobalDebugMode();if(window.isTrackingServiceReady&&window.isConsentProcessed){if(window.waitingTrackingActions.length>0){if(isDebug)console.log(`[Helper V4] Podmínky splněny. Spouštím ${window.waitingTrackingActions.length} čekajících akcí.`);while(window.waitingTrackingActions.length>0){const item=window.waitingTrackingActions.shift();if(isDebug)console.log(`[Helper V4] Spouštím z fronty: ${item.name}`);try{if(window.trackingService&&typeof window.trackingService==='object'){item.action()}else{console.error(`[Helper V4] TrackingService zmizela nebo není objekt před spuštěním ${item.name} z fronty! Typ: ${typeof window.trackingService}`)}}catch(error){console.error(`[Helper V4] Chyba při provádění ${item.name} z fronty:`,error)}}
    if(isDebug)console.log('[Helper V4] Fronta čekajících akcí vyprázdněna.');}}else{if(isDebug){console.log(`[Helper V4] Podmínky pro spuštění fronty zatím nesplněny: TrackingReady=${window.isTrackingServiceReady}, ConsentProcessed=${window.isConsentProcessed}`)}}}
function handleConsentProcessed(event){const detail=event.detail||{};const isDebug=getGlobalDebugMode();if(isDebug)console.log('[Helper V4] Událost "consentProcessed" přijata:',detail);const previouslyProcessed=window.isConsentProcessed;window.isConsentProcessed=!0;if(detail.status!=='success'){console.warn(`[Helper V4] Proces souhlasu byl dokončen se stavem '${detail.status}'. Chyba: ${detail.error || 'Nespecifikována'}`)}
    if(!previouslyProcessed&&detail.status==='success'){if(isDebug)console.log('[Helper V4] První úspěšné zpracování souhlasu, přidávám malé zpoždění před spuštěním akcí.');setTimeout(()=>{if(isDebug)console.log('[Helper V4] Spouštím attemptToTriggerTrackingActions po zpoždění (z handleConsentProcessed).');window.attemptToTriggerTrackingActions('handleConsentProcessed after delay')},250)}else{window.attemptToTriggerTrackingActions('handleConsentProcessed immediate')}}
window.executeTrackingWhenReady=function(trackingAction,actionName='Nespecifikovaná akce'){const isDebug=getGlobalDebugMode();if(isDebug){console.log(`[Helper V4] Požadavek na spuštění: ${actionName}. Stav: TrackingReady=${window.isTrackingServiceReady}, ConsentProcessed=${window.isConsentProcessed}`)}
    if(window.isTrackingServiceReady&&window.isConsentProcessed){if(isDebug)console.log(`[Helper V4] Spouštím ihned: ${actionName}`);try{if(window.trackingService&&typeof window.trackingService==='object'){trackingAction()}else{console.error(`[Helper V4] TrackingService není k dispozici (nebo není objekt) pro ${actionName}! Typ: ${typeof window.trackingService}`)}}catch(error){console.error(`[Helper V4] Chyba při provádění ${actionName}:`,error)}
        return}
    if(isDebug)console.log(`[Helper V4] Zařazuji do fronty: ${actionName}`);window.waitingTrackingActions.push({action:trackingAction,name:actionName});if(!consentProcessedListenerAttached&&!window.isConsentProcessed){if(isDebug)console.log('[Helper V4] Připojuji listener pro "consentProcessed".');document.addEventListener('consentProcessed',handleConsentProcessed,{once:!0});consentProcessedListenerAttached=!0}else if(isDebug&&consentProcessedListenerAttached&&!window.isConsentProcessed){if(isDebug)console.log('[Helper V4] Listener pro "consentProcessed" již byl připojen nebo {once: true} je aktivní, čekám na událost.');}};setTimeout(()=>{if(!window.isTrackingServiceReady||!window.isConsentProcessed){const isDebug=getGlobalDebugMode();if(isDebug||(window.waitingTrackingActions&&window.waitingTrackingActions.length>0)){console.warn(`[Helper V4 Timeout 7s] Podmínky stále nesplněny. Stav: TrackingReady=${window.isTrackingServiceReady}, ConsentProcessed=${window.isConsentProcessed}. Čekající akce: ${window.waitingTrackingActions ? window.waitingTrackingActions.length : 'N/A'}`)}}},7000)