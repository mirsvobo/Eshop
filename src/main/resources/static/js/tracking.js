console.log("Tracking JS loaded (v1.5 - Complete with begin_checkout)");const TrackingService={_gtagInitialized:!1,_rcInitialized:!1,_heurekaInitialized:!1,_hasConsent:function(t){if("undefined"==typeof CookieConsent)return console.warn("Consent check: CookieConsent library not found."),!1;if(!CookieConsent.validConsent())return!1;const n=t.every(t=>CookieConsent.acceptedCategory(t));return console.log(`Consent check result for [${t.join(", ")}]: ${n}`),n},_getSklikConsentValue:function(){const t=this._hasConsent(["marketing"]);return t?1:0},_runIfConsentGiven:function(t,n,o="callback"){if(this._hasConsent(t)){console.log(`Consent OK for [${t.join(", ")}]. Running ${o}.`);try{n()}catch(t){console.error(`Error executing ${o} for categories [${t.join(", ")}]:`,t)}}else console.log(`Consent NOT given for [${t.join(", ")}]. Skipping ${o}.`)},initBaseScripts:function(){var t;this._gtagInitialized="function"==typeof gtag,this._rcInitialized="function"==typeof(null===(t=window.rc)?void 0:t.conversionHit),this._heurekaInitialized="function"==typeof heureka,console.log(`TrackingService Initialized: gtag=${this._gtagInitialized}, Sklik=${this._rcInitialized}, Heureka=${this._heurekaInitialized}`),this._gtagInitialized||console.warn("TrackingService: gtag function NOT found."),this._rcInitialized||console.warn("TrackingService: Sklik (rc or rc.conversionHit) function NOT found."),this._heurekaInitialized||console.warn("TrackingService: Heureka function NOT found.")},trackViewItem:function(t){const n="trackViewItem";console.log(`TrackingService: ${n}`,t);if(!t||!t.variantId||null==t.priceNoVat)return void console.warn(`${n}: Missing required product data (variantId, priceNoVat). Skipping.`);const o=parseFloat(t.priceNoVat)||0,a=o;this._runIfConsentGiven(["analytics","marketing"],()=>{if(!this._gtagInitialized)return void console.warn("Gtag not initialized during "+n);const e={item_id:t.variantId,item_name:t.name,item_brand:t.brand,item_category:t.category,price:o.toFixed(2),quantity:1};gtag("event","view_item",{currency:t.currency,value:o.toFixed(2),items:[e]}),console.log("GA4: view_item sent",{currency:t.currency,value:o.toFixed(2),items:[e]}),gtag("event","conversion",{send_to:"AW-17046857865/5icqCLa-n8EaEInRycA_",value:a.toFixed(2),currency:t.currency,items:[{id:t.variantId,google_business_vertical:"retail"}]}),console.log("Ads: view_item (conversion) sent",{value:a.toFixed(2),currency:t.currency})},n+" GA/Ads"),this._runIfConsentGiven(["marketing"],()=>{if(!this._rcInitialized)return void console.warn("Sklik (rc) not initialized during "+n);const t={id:100245398,value:o.toFixed(2),consent:this._getSklikConsentValue()};window.rc.conversionHit(t),console.log("Sklik: view_item (conversionHit) sent",t)},n+" Sklik"),this._runIfConsentGiven(["marketing"],()=>{this._heurekaInitialized?console.log("Heureka SDK check OK for "+n+" (no action needed)."):console.warn("Heureka SDK not initialized during "+n+" check.")},n+" Heureka Check")},trackAddToCart:function(t){const n="trackAddToCart";console.log(`TrackingService: ${n}`,t);if(!t||!t.variantId||null==t.price||!t.currency||!t.quantity)return void console.warn(`${n}: Missing required item data. Skipping.`);const o=parseFloat(t.price)||0,a=parseInt(t.quantity)||1,e=o*a;this._runIfConsentGiven(["analytics","marketing"],()=>{if(!this._gtagInitialized)return void console.warn("Gtag not initialized during "+n);const s={item_id:t.variantId,item_name:t.name,item_brand:t.brand,item_category:t.category,price:o.toFixed(2),quantity:a};gtag("event","add_to_cart",{currency:t.currency,value:e.toFixed(2),items:[s]}),console.log("GA4: add_to_cart sent",{currency:t.currency,value:e.toFixed(2),items:[s]}),gtag("event","conversion",{send_to:"AW-17046857865/KT_JCK2-n8EaEInRycA_",value:e.toFixed(2),currency:t.currency,items:[{id:t.variantId,quantity:a,price:o.toFixed(2),google_business_vertical:"retail"}]}),console.log("Ads: add_to_cart (conversion) sent",{value:e.toFixed(2),currency:t.currency})},n+" GA/Ads")},trackBeginCheckout:function(t){const n="trackBeginCheckout";console.log(`TrackingService: ${n}`,t);if(!t||!Array.isArray(t.items)||null==t.value_no_vat||!t.currency)return void console.warn(`${n}: Missing required cart data (items, value_no_vat, currency). Skipping.`);const o="checkout_visited";if(sessionStorage.getItem(o))return void console.log(`${n}: Already tracked this session. Skipping.`);const a=parseFloat(t.value_no_vat)||0;this._runIfConsentGiven(["analytics","marketing"],()=>{if(!this._gtagInitialized)return void console.warn("Gtag not initialized during "+n);const e=t.items.map(t=>({item_id:t.variantId,item_name:t.name,item_brand:t.brand,item_category:t.category,price:(parseFloat(t.price)||0).toFixed(2),quantity:parseInt(t.quantity)||1}));gtag("event","begin_checkout",{currency:t.currency,value:a.toFixed(2),items:e}),console.log("GA4: begin_checkout sent",{currency:t.currency,value:a.toFixed(2),items:e.length}),gtag("event","conversion",{send_to:"AW-17046857865/YVBgCLC-n8EaEInRycA_",value:a.toFixed(2),currency:t.currency,items:e.map(t=>({id:t.item_id,quantity:t.quantity,price:t.price,google_business_vertical:"retail"}))}),console.log("Ads: begin_checkout (conversion) sent",{value:a.toFixed(2),currency:t.currency})},n+" GA/Ads"),this._runIfConsentGiven(["marketing"],()=>{if(!this._rcInitialized)return void console.warn("Sklik (rc) not initialized during "+n);const t={id:100245400,value:a.toFixed(2),consent:this._getSklikConsentValue()};window.rc.conversionHit(t),console.log("Sklik: begin_checkout (conversionHit) sent",t)},n+" Sklik");try{sessionStorage.setItem(o,"true"),console.log(`${n}: Flag set in sessionStorage.`)}catch(t){console.error("Error setting sessionStorage item:",t)}},trackPurchase:function(t){const n="trackPurchase";console.log(`TrackingService: ${n}`,t);if(!t||!t.transaction_id||!Array.isArray(t.items)||null==t.value||null==t.value_no_vat||!t.currency)return void console.warn(`${n}: Missing required order data. Skipping.`);const o=parseFloat(t.value)||0,a=parseFloat(t.tax)||0,e=parseFloat(t.shipping)||0,s=parseFloat(t.value_no_vat)||0,i=parseFloat(t.shipping_no_vat)||0,r=s+i;this._runIfConsentGiven(["analytics","marketing"],()=>{if(!this._gtagInitialized)return void console.warn("Gtag not initialized during "+n);const c=t.items.map(t=>({item_id:t.item_id,item_name:t.item_name,item_brand:t.item_brand,item_category:t.item_category,price:(parseFloat(t.price)||0).toFixed(2),quantity:parseInt(t.quantity)||1}));gtag("event","purchase",{transaction_id:t.transaction_id,value:o.toFixed(2),currency:t.currency,tax:a.toFixed(2),shipping:e.toFixed(2),items:c}),console.log("GA4: purchase sent",{transaction_id:t.transaction_id,value:o.toFixed(2),tax:a.toFixed(2),shipping:e.toFixed(2),items:c.length}),gtag("event","conversion",{send_to:"AW-17046857865/I-9yCKq-n8EaEInRycA_",value:r.toFixed(2),currency:t.currency,transaction_id:t.transaction_id,items:c.map(t=>({id:t.item_id,quantity:t.quantity,price:t.price,google_business_vertical:"retail"}))}),console.log("Ads: purchase (conversion) sent",{transaction_id:t.transaction_id,value:r.toFixed(2),currency:t.currency})},n+" GA/Ads"),this._runIfConsentGiven(["marketing"],()=>{if(this._rcInitialized){const o={id:100245399,value:r.toFixed(2),order_id:t.transaction_id,consent:this._getSklikConsentValue()};window.rc.conversionHit(o),console.log("Sklik: purchase (conversionHit) sent",o)}else console.warn("Sklik (rc) not initialized, skipping purchase conversion.");if(this._heurekaInitialized&&Array.isArray(t.heureka_items))try{heureka("authenticate","337b0666ea50d1f4fcd05d5473cfef9e43ec"),heureka("set_order_id",t.transaction_id),heureka("set_currency",t.currency),t.heureka_items.forEach(t=>{t&&t.itemId&&t.name&&null!=t.priceVat&&t.quantity>0?heureka("add_product",t.itemId,t.name,(parseFloat(t.priceVat)||0).toFixed(2),t.quantity):console.warn("Skipping invalid Heureka item:",t)});const o=parseFloat(t.heureka_total_vat)||0;heureka("set_total_vat",o.toFixed(2)),heureka("send","Order"),console.log("Heureka: Order conversion sent",{orderId:t.transaction_id,totalVat:o.toFixed(2),itemCount:t.heureka_items.length})}catch(t){console.error("Heureka Order conversion failed:",t)}else this._heurekaInitialized||console.warn("Heureka SDK not initialized, skipping purchase conversion."),Array.isArray(t.heureka_items)||console.warn("Heureka items data missing or not an array, skipping purchase conversion.")},n+" Sklik/Heureka")},trackContactClick:function(t){const n="trackContactClick";console.log(`TrackingService: ${n}`,t),this._runIfConsentGiven(["analytics","marketing"],()=>{this._gtagInitialized?(gtag("event","generate_lead",{value:10,currency:"CZK"}),console.log(`GA4: generate_lead (contact click) sent - Type: ${t}`),gtag("event","conversion",{send_to:"AW-17046857865/QfVhCLO-n8EaEInRycA_",value:10,currency:"CZK"}),console.log(`Ads: contact (conversion) sent - Type: ${t}`)):console.warn("Gtag not initialized during "+n)},n+" GA/Ads")}};document.addEventListener("click",function(t){const n=t.target.closest("a.track-contact-click");if(n){const t=n.getAttribute("href");let o="unknown";(null==t?void 0:t.startsWith("tel:"))?o="phone":(null==t?void 0:t.startsWith("mailto:"))&&(o="email"),"undefined"!=typeof TrackingService&&"function"==typeof TrackingService.trackContactClick?TrackingService.trackContactClick(o):console.warn("TrackingService or trackContactClick not ready for contact click event.")}});function initializeTrackingAfterConsent(){console.log("Global: initializeTrackingAfterConsent called. Attempting to init TrackingService base scripts."),"undefined"!=typeof TrackingService&&"function"==typeof TrackingService.initBaseScripts?TrackingService.initBaseScripts():(console.error("TrackingService is not defined when initializeTrackingAfterConsent was called!"),setTimeout(()=>{if("undefined"!=typeof TrackingService&&"function"==typeof TrackingService.initBaseScripts)console.log("Retrying TrackingService init after delay..."),TrackingService.initBaseScripts();else{console.error("TrackingService still not defined after delay!")}},500))}console.log("Tracking JS execution finished (v1.5).");

